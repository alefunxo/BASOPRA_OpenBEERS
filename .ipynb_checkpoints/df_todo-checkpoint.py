import pandas as pd
import itertools
def expand_grid(dct):
    rows = itertools.product(*dct.values())
    return pd.DataFrame.from_records(rows, columns=dct.keys())
    
def get_combinations_todo(df_done):
    aux=df_done.groupby([df_done.Capacity,df_done.App_comb,df_done.Tech,df_done.PV_nom,df_done.cluster,df_done.hh,df_done.country,df_done.cases,df_done.conf,df_done.HP,df_done.house_type]).size().reset_index()
    dct={'Capacity':[7],'App_comb':[0.,1,2,3,4,5,6,7],'Tech':['NMC','NCA','LTO','LFP','ALA','VRLA'],'PV_nom':[4.8],'country':['CH'],'cases':['mean','False'],'name':['110141755827', '110141755828', '110141755829', '110141755830', '110141755831', '110141755832', '110141755833', '110141755834', '110141755835', '110141755836', '110141755837', '110141755838', '110141755839', '110141755840', '110141755841', '110141755842', '110141755843', '110141755844', '110141755845', '110141755846', '110141755847', '110141755848', '110141755849', '110141755850', '110141755851', '110141755852', '110141755853', '110141755854', '110141755855', '110141755856', '110141755857', '110141755858', '110141755859', '110141755860', '110141755861', '110141755862', '110141755863', '110141955877', '110141955878', '110141955879', '110141955880', '110141955882', '110141955884', '110141955885', '110141955887', '110141955889', '110141955890', '110141955891', '110141955893', '110141955895', '110141955897', '110141955898', '110141955899', '110141955901', '110141955902', '110141955905', '110141955906', '110141955907', '110141955908', '110141955909', '110141955910', '110141955911', '110141955912', '110142355939', '110142355940', '110142355941', '110142355942', '110142355943', '110142355944', '110142355945', '110142355946', '110142355947', '110142556012', '110142556013', '110142556015', '110142556016', '110142556017', '110142556018', '110142756041', '110142756042', '110142756043', '110142756044', '110142756045', '110142756046', '110142756047', '110142956052', '110142956053', '110142956055', '110142956056', '110142956057', '110142956058', '110142956059', '110142956060', '110142956061', '110142956062', '110142956063', '110142956064', '110142956065', '110142956066', '110143156073', '110143156074', '110143156075', '110143156076', '110143156077', '110143156078', '110143356092', '110143556101', '110143556102', '110143556103', '110143556104', '110143556105', '110143556106', '110143556107', '110143556108', '110143756116', '110143756118', '110143756120', '110143756122', '110143756124', '110143756126', '110143956137', '110143956140', '110143956143', '110143956145', '110143956148', '110143956150', '110143956153', '110144156205', '110144156209', '110144156211', '110144156214', '110144156217', '110144156221', '110144156225', '110144156229', '110144356264', '110144356267', '110144356269', '110144356270', '110144356271', '110144356272', '110144356273', '110144356274', '110144556313', '110144556314', '110144556315', '110144556316', '110144556317', '110144556318', '110144556320', '110144556322', '110144756372', '110144756374', '110144756376', '110144756379', '110144756381', '110144756384', '110144756386', '110144756389', '110144856395', '110144856397', '110144856399', '110144856401', '110144856404', '110144856407', '110144856411', '110145056430', '110145056432', '110145056435', '110145056438', '110145056441', '110145056447', '110145056453', '110145156456', '110145156459', '110145156462', '110145156465', '110145156468', '110145156471', '110145256477', '110145256480', '110145256483', '110145256486', '110145256489', '110145256492', '110145256495', '110145356499', '110145356503', '110145356505', '110145356508', '110145356511', '110145356514', '110145356516', '110145456520', '110145456522', '110145456524', '110145456526', '110145456529', '110145456531', '110145556534', '110145556537', '110145556540', '110145556543', '110145556546', '110145556549', '110145556552', '110145556555', '110145556562', '110145656567', '110145656570', '110145656576', '110145656579', '110145756582', '110145856588', '110146056594', '110146056597', '110146156603', '110696128835', '110696128837', '110696128842', '110696128845', '110696128849', '110696128853', '110696128856', '110696128859', '110696128862', '110696128864', '110696328873', '110696328876', '110696328879', '110696328882', '110696328884', '110696328886', '110696328889', '110696328892', '110696328896', '110696328899', '110696428960', '110696428963', '110696428966', '110696428969', '110696428972', '110696428975', '110696428978', '110696428981', '110696428984', '110696428987', '110696528990', '110696528993', '110696528996', '110696529000', '110696529004', '110696529007', '110696529011', '110696529013', '110696529016', '110696529018', '110696529022', '110696529024', '110696529027', '110696529030', '110696529033', '110696529037', '110696529040', '110696529044', '110696529047', '110696629051', '110696629055', '110696629058', '110696629062', '110696629065', '110696629067', '110696629071', '110696629073', '110696629077', '110696629081', '110696629086', '110696729091', '110696729096', '110696729099', '110696729103', '110696729107', '110696729111', '110696729115', '110696729119', '110696729124', '110696729126', '110696729128', '110696729133', '110696729137', '110696729140', '110696729145', '110696729150', '110696729154', '110696729157', '110696829161', '110696829164', '110696829172', '110696829176', '110696829179', '110696829183', '110696829190', '110696829194', '110696829197', '110696829200', '110696929203', '110696929206', '110696929209', '110696929213', '110696929216', '110696929220', '110696929224', '110696929228', '110696929232', '110696929236', '110696929241', '110696929245', '110696929249', '110696929253', '110696929256', '110696929258', '110696929262', '110696929265', '110696929268', '110696929272', '110696929276', '110696929280', '110696929283', '110696929286', '110696929290', '110697029296', '110697029301', '110697029304', '110697029308', '110697029312', '110697029314', '110697029318', '110697029321', '110697029326', '110697129330', '110697129333', '110697129336', '110697129340', '110697129344', '110697129348', '110697129350', '110697129353', '110697129356', '110697129359', '110697129362', '110697129366', '110697129369', '110697129372', '110697129375', '110697129381', '110697129383', '110697229396', '110697229401', '110697229406', '110697229408', '110697229411', '110697229419', '110697229423', '110697229425', '110697229429', '110697229432', '110697329441', '110697329444', '110697329446', '110697329450', '110697329454', '110697329456', '110697329461', '110697329465', '110697329468', '110697329472', '110697329474', '110697329477', '110697329480', '110697329483', '110697329486', '110697329488', '110697429491', '110697429495', '110697429498', '110697429503', '110697429509', '110697429513', '110697429516', '110697529529', '110697529533', '110697529538', '110697529546', '110697529550', '110697529557', '110697529561', '110697529565', '110697529569', '110697529571', '110697529574', '110697529577', '110697629584', '110697629587', '110697629595', '110697629599', '110697629603', '110697629607', '110697629610', '110697629613', '110697729616', '110697729619', '110697729624', '110697729630', '110697729634', '110697729637', '110697729641', '110697729644', '110697729648', '110697729651', '110697729654', '110697829664', '110697829668', '110697829670', '110697829674', '110697829679', '110697829690', '110697829696', '110697829698', '110697829700', '110697929712', '110697929717', '110697929723', '110697929727', '110697929733', '110697929735', '110697929737', '110697929745', '110698029749', '110698029755', '110698029760', '110698029765', '110698029768', '110698029770', '110698029774', '110698029777', '110698129789', '110698129793', '110698129799', '110698129801', '110698129805', '110698129812', '110698229816', '110698229819', '110698229823', '110698229825', '110698229827', '110698229830', '110698229835', '110698229838', '110698329851', '110698329854', '110698329858', '110698329861', '110698329867', '110698329871', '110698329876', '110698329880', '110698329884', '110698429896', '110698429899', '110698429902', '110698429906', '110698429909', '110698429912', '110698429916', '110698529920', '110698529926', '110698529930', '110698529934', '110698529936', '110698529939', '110698529942', '110698529945', '110698529950', '110698529953', '110698629959', '110698629962', '110698629965', '110698629969', '110698629973', '110698629977', '110698629981', '110698629985', '110698629989', '110698629992', '110698729999', '110698730003', '110698730006', '110698730009', '110698730012', '110698730016', '110698730025', '110698730035', '110698730039', '110698730043', '110698830051', '110698830053', '110698830056', '110698830059', '110698830061', '110698830063', '110698830065', '110698830067', '110698830069', '110698830071', '110698830073', '110698830079', '110698930088', '110698930092', '110698930096', '110698930100', '110698930104', '110698930108', '110698930113', '110698930117', '110699030125', '110699030128', '110699030131', '110699030135', '110699030138', '110699030142', '110699030146', '110699130150', '110699130153', '110699130157', '110699130162', '110699130166', '110699130169', '110699130172', '110699130179', '110699130183', '110699130188', '110699130193', '110699130197', '110699230205', '110699230209', '110699230217', '110699230221', '110699230224', '110699230227', '110699230230', '110699230232', '110699330235', '110699330237', '110699330238', '110699330239', '110699330240', '110699330241', '110699430242', '110699430243', '110699430245', '110699430246', '110699430248', '110699430250', '110699430252', '110699430254', '110699430256', '110699430258', '110699430260', '110699430262', '110699430264', '1127341129655', '1127341129656', '1127341129657', '1127341129658', '1127341129659', '1127341129660', '1127341129661', '1127341129662', '1127341129663', '1127341129664', '1127342129667', '1127342129668', '1127342129669', '1127342129670', '1127342129671', '1127342129672', '1127342129673', '1127342129674', '1127343127586', '1127343129675', '1127343129676', '1127343129677', '1127343129678', '1127343129679', '1127343129680', '1127343129681', '1127343129682', '1127343129683', '1127344127587', '1127344129685', '1127344129686', '1127344129687', '1127344129688', '1127344129689', '1127344129690', '1127344129691', '1127344129692', '1127344129693', '1127345127588', '1127345129695', '1127345129697', '1127345129698', '1127345129700', '1127345129701', '1127345129702', '1127345129703', '1127345129704', '1127345129705', '1127346127589', '1127346129706', '1127346129707', '1127346129708', '1127346129709', '1127346129710', '1127346129712', '1127347127590', '1127347129713', '1127347129714', '1127347129715', '1127347129716', '1127347129717', '1127347129719', '1127347129720', '1127348127591', '1127348129725', '1127348129726', '1127348129729', '1127348129730', '1127348129731', '1127349127592', '1127349129734', '1127349129735', '1127349129736', '1127349129739', '1127349129743', '1127350127593', '1127350129746', '1127350129747', '1127351127594', '1127351129751', '1127351129752', '1127351129753', '1127351129754', '1127351129756', '1127351129757', '1127351129758', '1127351129760', '1127352129767', '1127353129781', '1127354129797', '1127354129799', '1127355129773', '1127355129783', '1127355129784', '1127355129786', '113350355883']}
    Total_combs=expand_grid(dct)

    if aux.empty:
        Combs_todo=Total_combs.copy()
    else:

        Combs_todo=aux.merge(Total_combs,how='outer',indicator=True)#Warning

        Combs_todo=Combs_todo[Combs_todo['_merge']=='right_only']
        Combs_todo=Combs_todo.loc[:,Combs_todo.columns[:-1]]

    print(Combs_todo.head())
    Combs_todo=[dict(Combs_todo.loc[i,:]) for i in Combs_todo.index]
    todo=pd.DataFrame(Combs_todo)
    return todo